<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Listen - Floating Button</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      width: 60px;
      height: 60px;
      overflow: hidden;
      background: transparent;
      cursor: grab;
    }

    #floating-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid rgba(76, 175, 80, 0.5);
      backdrop-filter: blur(20px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      transition: all 0.2s ease;
      position: relative;
      cursor: grab;
    }

    #floating-button:hover {
      background: rgba(76, 175, 80, 0.4);
      border-color: #4CAF50;
      transform: scale(1.05);
    }

    #floating-button:active {
      cursor: grabbing;
    }

    /* Recording state - red pulsing glow */
    #floating-button.recording {
      animation: pulse-glow 1s ease-in-out infinite;
      background: rgba(244, 67, 54, 0.2);
      border-color: #f44336;
    }

    /* Processing state - orange */
    #floating-button.processing {
      background: rgba(255, 152, 0, 0.2);
      border-color: #ff9800;
    }

    /* Ready/Idle state - green */
    #floating-button.idle {
      background: rgba(76, 175, 80, 0.2);
      border-color: rgba(76, 175, 80, 0.5);
    }

    @keyframes pulse-glow {
      0%, 100% {
        opacity: 0.6;
      }
      50% {
        opacity: 1;
      }
    }

    .mic-icon {
      width: 32px;
      height: 32px;
      fill: #4CAF50;
    }

    #floating-button.recording .mic-icon {
      fill: #f44336;
    }

    #floating-button.processing .mic-icon {
      fill: #ff9800;
    }

    /* Tooltip styling */
    .tooltip {
      position: absolute;
      bottom: -45px;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      background: rgba(0, 0, 0, 0.85);
      color: #ffffff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
      z-index: 10001;
    }

    #floating-button:hover .tooltip {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="floating-button" class="idle">
    <svg class="mic-icon" viewBox="0 0 24 24" fill="currentColor">
      <!-- Microphone icon SVG -->
      <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
      <path d="M17 16.91c-1.48 1.46-3.51 2.36-5.77 2.36-2.26 0-4.29-.9-5.77-2.36M19 12h2c0 .29-.02.58-.07.86-.59 3.54-3.7 6.14-7.43 6.14-3.73 0-6.84-2.6-7.43-6.14-.05-.28-.07-.57-.07-.86h2c0 2.62 1.91 4.95 4.57 5.48V21h2v-2.52c2.66-.53 4.57-2.86 4.57-5.48z"/>
    </svg>
    <div class="tooltip">Click to record (Ctrl+Shift+Space)</div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    const button = document.getElementById('floating-button');
    const body = document.body;

    let isDragging = false;
    let dragStartX = null;
    let dragStartY = null;

    // Click to toggle recording
    button.addEventListener('click', (e) => {
      // Only trigger if not dragging
      if (!isDragging) {
        ipcRenderer.send('floating-button-click');
      }
    });

    // Dragging support
    button.addEventListener('mousedown', (e) => {
      isDragging = false; // Reset on mousedown
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      button.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', (e) => {
      if (e.buttons === 1 && dragStartX !== null) { // Left mouse button is pressed
        const deltaX = e.clientX - dragStartX;
        const deltaY = e.clientY - dragStartY;

        // Consider it dragging if moved more than 3 pixels
        if (Math.abs(deltaX) > 3 || Math.abs(deltaY) > 3) {
          isDragging = true;
          ipcRenderer.send('floating-button-drag', { deltaX, deltaY });
        }
      }
    });

    document.addEventListener('mouseup', () => {
      if (isDragging) {
        ipcRenderer.send('floating-button-drag-end');
        isDragging = false;
      }
      button.style.cursor = 'grab';
      dragStartX = null;
      dragStartY = null;
    });

    // Listen for state updates from main process
    ipcRenderer.on('floating-button-state', (event, { state }) => {
      button.className = state;
    });

    // Request initial state
    ipcRenderer.send('floating-button-ready');
  </script>
</body>
</html>
